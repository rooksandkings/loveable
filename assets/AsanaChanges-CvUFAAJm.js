import{j as e}from"./ui-vendor-CVcv4Zzz.js";import{r as t}from"./react-vendor-tkGVC3Du.js";import{u as s}from"./query-vendor-B8TzFr-Q.js";import{B as a,C as n,h as r,i as l,a as i,I as d,S as o,b as c,d as x,e as h,f as m,k as p,g}from"./neon-api-D1ar_Ef1.js";import{e as u,f as b,D as y,g as w,B as f,T as j,H as v,Z as N,h as C,i as k}from"./icons-CwoiqeW0.js";import"./index-CcSzFDtL.js";const _=()=>{const[_,S]=t.useState(""),[A,L]=t.useState("all"),[O,D]=t.useState("all"),[T,F]=t.useState(new Set),[$,P]=t.useState("50"),[M,z]=t.useState({}),[U,B]=t.useState(!1),R=e=>{if(!e)return"";try{const t=new Date(e),s=t.getMonth()+1,a=t.getDate(),n=t.getFullYear().toString().slice(-2),r=t.getHours(),l=t.getMinutes(),i=r>=12?"PM":"AM";return`${s}/${a}/${n}\n${r%12||12}:${l.toString().padStart(2,"0")} ${i}`}catch(t){return e}},I=e=>e?e.replace(/\s*-\s*in\s+foster\s*$/i,"").replace(/\s*-\s*foster\s*$/i,"").replace(/\s*\(foster\)\s*$/i,"").replace(/\s*\[foster\]\s*$/i,"").trim():"",{data:V=[],isLoading:q,error:E}=s({queryKey:["asanaProposedChanges"],queryFn:p,staleTime:432e5,gcTime:864e5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,retry:3,retryDelay:e=>Math.min(1e3*2**e,3e4)}),{data:H}=s({queryKey:["dogs"],queryFn:g,staleTime:432e5,gcTime:864e5,refetchOnWindowFocus:!1,refetchOnMount:!1,refetchOnReconnect:!1,retry:3,retryDelay:e=>Math.min(1e3*2**e,3e4)});t.useMemo(()=>{const e=new Map;return H&&H.forEach(t=>{t.dog_id&&t.shelter_location&&e.set(t.dog_id,t.shelter_location)}),e},[H]);const K=t.useMemo(()=>{const e=V.map(e=>e.asana_category).filter(e=>e&&""!==e.trim()).sort();return[...new Set(e)]},[V]),W=t.useMemo(()=>{let e=V.filter(e=>{const t=""===_||e.name?.toLowerCase().includes(_.toLowerCase())||e.animal_id?.toLowerCase().includes(_.toLowerCase())||e.comments_sanitized?.toLowerCase().includes(_.toLowerCase())||e.proposed_value?.toLowerCase().includes(_.toLowerCase()),s="all"===A||e.asana_category===A;let a=!0;switch(O){case"all":default:a=!0;break;case"DCAS":a="DCAS"===e.shelter_location;break;case"FCAS":a="FCAS"===e.shelter_location;break;case"CAC":a="CAC"===e.shelter_location}const n=(e.current_value||"").trim().toLowerCase(),r=(e.proposed_value||"").trim().toLowerCase();return t&&s&&a&&n!==r});if(e.sort((e,t)=>{const s=I(e.name||"").toLowerCase(),a=I(t.name||"").toLowerCase();return s!==a?s.localeCompare(a):new Date(t.created_at).getTime()-new Date(e.created_at).getTime()}),U){const t=new Map;e.forEach(e=>{const s=`${I(e.name||"").toLowerCase()}-${e.asana_category}`;t.has(s)||t.set(s,e)}),e=Array.from(t.values()),e.sort((e,t)=>{const s=I(e.name||"").toLowerCase(),a=I(t.name||"").toLowerCase();return s!==a?s.localeCompare(a):new Date(t.created_at).getTime()-new Date(e.created_at).getTime()})}if("all"!==$){const t=parseInt($);e=e.slice(0,t)}return e},[V,_,A,O,$,U]),Y=t=>{const s=(t||"").toLowerCase();return s.includes("crate")?e.jsx(u,{className:"w-5 h-5 text-amber-800"}):s.includes("leash")?e.jsx(b,{className:"w-5 h-5 text-purple-600"}):s.includes("dog")?e.jsx(y,{className:"w-5 h-5 text-blue-600"}):s.includes("cat")?e.jsx(w,{className:"w-5 h-5 text-orange-500"}):s.includes("kid")?e.jsx(f,{className:"w-5 h-5 text-pink-500"}):s.includes("potty")?e.jsx(j,{className:"w-5 h-5 text-amber-500"}):s.includes("cuddle")?e.jsx(v,{className:"w-5 h-5 text-red-500"}):s.includes("energy")||s.includes("activity")?e.jsx(N,{className:"w-5 h-5 text-yellow-600"}):s.includes("more about")?e.jsx(C,{className:"w-5 h-5 text-green-600"}):e.jsx(k,{className:"w-5 h-5 text-gray-500"})},G=e=>{const t=(e||"").toLowerCase();return t.includes("crate")?["Override","Has done well in a crate","No info","Working on it","Crates are scary"]:t.includes("leash")?["Override","Walks politely on leash","Pulls some but manageable","Strong puller","Leash bites when excited","Reactive on leash, distract me with treats","Leash reactive to small animals","Leash reactive to dogs","Leash reactive to people","Flight risk"]:t.includes("dog")?["Override","Lived with dogs","Has enjoyed interacting with dogs","Likes some dogs (dog selective)","Only dog","Unknown/Not tested"]:t.includes("cat")?["Override","Positive history with cats","Does not like cats","Could do well with proper introductions","Unknown/No history"]:t.includes("kid")?["Override","Positive history with kids","Best with older kids","No kids please","Unknown"]:t.includes("potty")?["Override","Has done well in a home","Still working on it","Not potty trained","Unknown, but happy to learn!"]:t.includes("cuddle")?["Override","Let's get to know each other before cuddling","I'm affectionate with my friends","Play first, then snuggle time","Super cuddly!"]:t.includes("energy")||t.includes("activity")?["Override","1- Low energy","2- Medium energy","3- High energy","4- Regular running/hiking partner"]:t.includes("more about")?["Override","Loves fetch","Loves toys","Knows tricks","Knows basic commands","Volunteer favorite","Staff favorite","Fast learner","Loves car rides","Quiet house guest"]:["Override"]};return q?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-8",children:e.jsx("div",{className:"max-w-7xl mx-auto",children:e.jsx("div",{className:"text-center",children:e.jsx("div",{className:"text-lg text-gray-600",children:"Loading Asana proposed changes..."})})})}):E?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 flex items-center justify-center",children:e.jsxs("div",{className:"text-center",children:[e.jsx("div",{className:"text-8xl mb-6",children:"ðŸ˜¢"}),e.jsx("h2",{className:"text-2xl font-semibold text-gray-700 mb-2",children:"Oops! Something went wrong"}),e.jsx("p",{className:"text-gray-500 mb-4",children:"We couldn't fetch the Asana proposed changes right now"}),e.jsx(a,{onClick:()=>window.location.reload(),className:"bg-blue-500 hover:bg-blue-600",children:"Try Again"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-50 p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900 mb-4",children:"Asana Proposed Changes"}),e.jsx("p",{className:"text-gray-600",children:"Review and manage proposed changes from Asana comments"})]}),e.jsxs(n,{className:"mb-6",children:[e.jsx(r,{children:e.jsx(l,{children:"Filters"})}),e.jsx(i,{children:e.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[e.jsx("div",{className:"flex-1",children:e.jsx(d,{placeholder:"Search by name, ID, comments, or proposed value...",value:_,onChange:e=>S(e.target.value),className:"w-full"})}),e.jsxs(o,{value:A,onValueChange:L,children:[e.jsx(c,{className:"w-48",children:e.jsx(x,{placeholder:"All Categories"})}),e.jsxs(h,{children:[e.jsx(m,{value:"all",children:"All Categories"}),K.map(t=>e.jsx(m,{value:t,children:t},t))]})]}),e.jsxs(o,{value:O,onValueChange:D,children:[e.jsx(c,{className:"w-48",children:e.jsx(x,{placeholder:"All Locations"})}),e.jsxs(h,{children:[e.jsx(m,{value:"all",children:"All Locations"}),e.jsx(m,{value:"DCAS",children:"DCAS"}),e.jsx(m,{value:"FCAS",children:"FCAS"}),e.jsx(m,{value:"CAC",children:"CAC"})]})]})]})})]}),e.jsx(n,{className:"mb-4",children:e.jsx(i,{className:"p-4",children:e.jsxs("div",{className:"flex flex-wrap justify-between gap-4 text-xs",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[Y("crate"),e.jsx("span",{children:"Crate trained"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y("leash"),e.jsx("span",{children:"Leash skills"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y("dog"),e.jsx("span",{children:"Dog interaction"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y("cat"),e.jsx("span",{children:"Cat interaction"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y("kid"),e.jsx("span",{children:"Kid interaction"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y("potty"),e.jsx("span",{children:"Potty training"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y("cuddle"),e.jsx("span",{children:"Cuddle meter"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y("energy"),e.jsx("span",{children:"Energy level"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[Y("more about"),e.jsx("span",{children:"More about me"})]})]})})}),e.jsxs("div",{className:"mb-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("span",{className:"text-gray-600 font-medium",children:[W.length," of ",V.length," proposed changes"]}),e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Show:"}),e.jsxs(o,{value:$,onValueChange:P,children:[e.jsx(c,{className:"w-20",children:e.jsx(x,{})}),e.jsxs(h,{children:[e.jsx(m,{value:"25",children:"25"}),e.jsx(m,{value:"50",children:"50"}),e.jsx(m,{value:"100",children:"100"}),e.jsx(m,{value:"200",children:"200"}),e.jsx(m,{value:"all",children:"All"})]})]}),e.jsx("span",{className:"text-sm text-gray-600",children:"per page"})]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx(a,{variant:"outline",size:"sm",onClick:()=>{const e=W.map(e=>e.comment_gid);F(new Set(e))},className:"text-xs",children:"Select All"}),e.jsx(a,{variant:"outline",size:"sm",onClick:()=>{F(new Set)},className:"text-xs",children:"Clear All"})]})]})]}),e.jsx("div",{className:"mt-2 flex justify-start",children:e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Show only latest change per category per dog"}),e.jsx("input",{type:"checkbox",id:"showLatestOnly",checked:U,onChange:e=>B(e.target.checked),className:"h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"})]})})]}),e.jsx(n,{children:e.jsx(i,{className:"p-0",children:e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"w-full table-fixed",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-24 border-r border-gray-200",children:"Timestamp"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-32 border-r border-gray-200",children:"Animal"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-32 whitespace-nowrap border-r border-gray-200",children:"Current"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-40 whitespace-nowrap border-r border-gray-200",children:"Update"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider border-r border-gray-200",children:"Comment"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-20 border-r border-gray-200",children:"Type"}),e.jsx("th",{className:"px-4 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider w-24",children:"Select"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:W.map((t,s)=>e.jsxs("tr",{className:s%2==0?"bg-white":"bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 text-sm text-gray-900 text-center w-24 border-r border-gray-200",children:e.jsx("div",{className:"whitespace-pre-line text-center text-xs",children:R(t.created_at)})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-900 text-center border-r border-gray-200",children:e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:I(t.name||"")}),e.jsx("div",{className:"text-xs text-gray-500",children:"DCAS"===t.shelter_location?"Dekalb":"FCAS"===t.shelter_location?"Fulton":"CAC"===t.shelter_location?"CAC":t.shelter_location||"Unknown"}),t.foster_status&&e.jsx("div",{className:"text-xs text-gray-500",children:t.foster_status})]})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-900 text-center whitespace-nowrap w-32 border-r border-gray-200",children:e.jsx("div",{className:"three-line-ellipsis text-xs",title:t.current_value,children:t.current_value||"N/A"})}),e.jsxs("td",{className:"px-4 py-4 text-sm text-gray-900 text-center w-40 border-r border-gray-200",children:[e.jsx("div",{className:"text-xs text-gray-500 mb-2 leading-tight min-h-[2.5rem] flex items-center justify-center",children:t.proposed_value||"N/A"}),e.jsxs(o,{value:M[t.comment_gid]||"Override",onValueChange:e=>((e,t)=>{z(s=>({...s,[e]:t}))})(t.comment_gid,e),children:[e.jsx(c,{className:"w-full mx-1 h-8 text-xs",style:{textAlign:"center"},children:e.jsx(x,{placeholder:"Override..."})}),e.jsx(h,{className:"max-h-60",children:G(t.asana_category).map((t,s)=>e.jsx(m,{value:t,className:"text-xs",children:t},s))})]})]}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-900 border-r border-gray-200",children:e.jsx("div",{className:"whitespace-pre-wrap break-words text-xs leading-relaxed",children:t.comments_sanitized||"No comments"})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-900 text-center border-r border-gray-200",children:e.jsx("div",{className:"flex items-center justify-center",title:t.asana_category||"Unknown",children:Y(t.asana_category)})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 text-center",children:e.jsx("div",{className:"flex justify-center",children:e.jsx("input",{type:"checkbox",checked:T.has(t.comment_gid),onChange:()=>{return e=t.comment_gid,void F(t=>{const s=new Set(t);return s.has(e)?s.delete(e):s.add(e),s});var e},className:"h-4 w-4 text-blue-500 border-gray-300 rounded focus:ring-blue-500 focus:ring-2"})})})]},t.comment_gid))})]})})})}),e.jsx("div",{className:"mt-6 flex justify-center gap-4",children:e.jsx(a,{size:"lg",className:"bg-blue-500 hover:bg-blue-600 text-white px-8 py-4 text-lg font-semibold",onClick:()=>{const e=W.filter(e=>T.has(e.comment_gid));if(0===e.length)return void alert("Please select at least one proposed change to review.");let t='<table style="width: 100%; border-collapse: collapse; font-family: monospace; font-size: 14px;">\n                <thead>\n                  <tr style="background-color: #f3f4f6; border-bottom: 2px solid #d1d5db;">\n                    <th style="padding: 12px; text-align: left; border: 1px solid #d1d5db; width: 15%;">Name</th>\n                    <th style="padding: 12px; text-align: left; border: 1px solid #d1d5db; width: 8%;">ID</th>\n                    <th style="padding: 12px; text-align: left; border: 1px solid #d1d5db; width: 10%;">Location</th>\n                    <th style="padding: 12px; text-align: left; border: 1px solid #d1d5db; width: 18%;">Field</th>\n                    <th style="padding: 12px; text-align: left; border: 1px solid #d1d5db; width: 20%;">Current Value</th>\n                    <th style="padding: 12px; text-align: left; border: 1px solid #d1d5db; width: 20%;">Update Value</th>\n                  </tr>\n                </thead>\n                <tbody>';e.forEach((e,s)=>{const a=M[e.comment_gid],n=a&&"Override"!==a?a:e.proposed_value,r="DCAS"===e.shelter_location?"Dekalb":"FCAS"===e.shelter_location?"Fulton":"CAC"===e.shelter_location?"CAC":e.shelter_location||"Unknown";t+=`\n                  <tr style="border-bottom: 1px solid #e5e7eb;">\n                    <td style="padding: 12px; border: 1px solid #d1d5db;">${I(e.name||"")}</td>\n                    <td style="padding: 12px; border: 1px solid #d1d5db;">${e.animal_id||""}</td>\n                    <td style="padding: 12px; border: 1px solid #d1d5db;">${r}</td>\n                    <td style="padding: 12px; border: 1px solid #d1d5db;">${e.asana_category||""}</td>\n                    <td style="padding: 12px; border: 1px solid #d1d5db;">${e.current_value||"N/A"}</td>\n                    <td style="padding: 12px; border: 1px solid #d1d5db;">${n||"N/A"}</td>\n                  </tr>`}),t+="\n                </tbody>\n              </table>";const s=window.open("","_blank","width=1200,height=800,scrollbars=yes,resizable=yes");s&&(s.document.write(`\n                  <!DOCTYPE html>\n                  <html lang="en">\n                  <head>\n                      <meta charset="UTF-8">\n                      <meta name="viewport" content="width=device-width, initial-scale=1.0">\n                      <title>ðŸ“‹ Asana Proposed Changes Summary</title>\n                      <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>ðŸ“‹</text></svg>">\n                      <style>\n                          body {\n                              font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n                              line-height: 1.6;\n                              margin: 0;\n                              padding: 20px;\n                              background: linear-gradient(135deg, #dbeafe 0%, #bfdbfe 100%);\n                              min-height: 100vh;\n                          }\n                          .container {\n                              max-width: 1200px;\n                              margin: 0 auto;\n                              background: white;\n                              border-radius: 12px;\n                              box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);\n                              overflow: hidden;\n                          }\n                          .header {\n                              background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);\n                              color: white;\n                              padding: 20px;\n                              text-align: center;\n                          }\n                          .header h1 {\n                              margin: 0;\n                              font-size: 24px;\n                              font-weight: bold;\n                          }\n                          .content {\n                              padding: 20px;\n                          }\n                          .text-box {\n                              background: #f8fafc;\n                              border: 2px solid #e2e8f0;\n                              border-radius: 8px;\n                              padding: 20px;\n                              font-size: 14px;\n                              line-height: 1.6;\n                              color: #374151;\n                              min-height: 400px;\n                              overflow-y: auto;\n                          }\n                          .copy-button {\n                              background: #3b82f6;\n                              color: white;\n                              border: none;\n                              padding: 12px 24px;\n                              border-radius: 6px;\n                              cursor: pointer;\n                              font-weight: 500;\n                              margin-top: 15px;\n                              width: 100%;\n                          }\n                          .copy-button:hover {\n                              background: #2563eb;\n                          }\n                          .footer {\n                              text-align: center;\n                              padding: 20px;\n                              color: #6b7280;\n                              font-size: 14px;\n                              border-top: 1px solid #e5e7eb;\n                          }\n                      </style>\n                  </head>\n                  <body>\n                      <div class="container">\n                          <div class="header">\n                              <h1>ðŸ“‹ Asana Proposed Changes Summary</h1>\n                          </div>\n                          <div class="content">\n                              <div class="text-box" id="copyText">${t}</div>\n                              <button class="copy-button" onclick="copyToClipboard()">Push Change (currently copy to clipboard)</button>\n                          </div>\n                          <div class="footer">\n                              <p>Generated by Paw Poster â€¢ Review proposed changes from Asana</p>\n                          </div>\n                      </div>\n                      \n                      <script>\n                          function copyToClipboard() {\n                              const textBox = document.getElementById('copyText');\n                              const text = textBox.textContent || textBox.innerText;\n                              \n                              navigator.clipboard.writeText(text).then(function() {\n                                  const button = document.querySelector('.copy-button');\n                                  button.textContent = 'âœ… Copied!';\n                                  button.style.background = '#10b981';\n                                  \n                                  setTimeout(function() {\n                                      button.textContent = 'Push Change (currently copy to clipboard)';\n                                      button.style.background = '#3b82f6';\n                                  }, 2000);\n                              }).catch(function(err) {\n                                  console.error('Could not copy text: ', err);\n                                  alert('Copy failed. Please manually select and copy the text.');\n                              });\n                          }\n                      <\/script>\n                  </body>\n                  </html>\n                `),s.document.close())},children:"ðŸ“‹ Review Selected Changes"})})]})})};export{_ as default};
